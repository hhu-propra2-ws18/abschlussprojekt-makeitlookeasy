<!DOCTYPE html>
<html lang="en" xmlns:="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
      name="viewport">
  <!-- before: content="width=device-width, initial-scale=1, shrink-to-fit=no" -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta content="" name="description">
  <meta content="" name="author">

  <title>Ausleiherino24</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" th:href="@{~/vendor/bootstrap/css/bootstrap.min.css}">

  <!-- Font awesome Css-->
  <link rel="stylesheet" th:href="@{~/vendor/fontawesome/fonts/font-awesome.min.css}">

  <!-- Custom styles for this template -->
  <link rel="stylesheet" th:href="@{~/css/shop-homepage.css}">
  <script>
    function oneFunction() {
      var mainFrameOne = document.getElementById("mainFrameOne");
      var mainFrameTwo = document.getElementById("mainFrameTwo");
      var mainFrameThree = document.getElementById("mainFrameThree");
      var mainFrameFour = document.getElementById("mainFrameFour");

      mainFrameOne.style.display = (
          mainFrameOne.style.display == "block" ? "block" : "block");
      mainFrameTwo.style.display = (
          mainFrameTwo.style.display == "none" ? "none" : "none");
      mainFrameThree.style.display = (
          mainFrameThree.style.display == "none" ? "none" : "none");
      mainFrameFour.style.display = (
          mainFrameFour.style.display == "none" ? "none" : "none");
    }

    function twoFunction() {
      var mainFrameOne = document.getElementById("mainFrameOne");
      var mainFrameTwo = document.getElementById("mainFrameTwo");
      var mainFrameThree = document.getElementById("mainFrameThree");
      var mainFrameFour = document.getElementById("mainFrameFour");

      mainFrameOne.style.display = (
          mainFrameOne.style.display == "none" ? "none" : "none");
      mainFrameTwo.style.display = (
          mainFrameTwo.style.display == "block" ? "block" : "block");
      mainFrameThree.style.display = (
          mainFrameThree.style.display == "none" ? "none" : "none");
      mainFrameFour.style.display = (
          mainFrameFour.style.display == "none" ? "none" : "none");
    }

    function threeFunction() {
      var mainFrameOne = document.getElementById("mainFrameOne");
      var mainFrameTwo = document.getElementById("mainFrameTwo");
      var mainFrameThree = document.getElementById("mainFrameThree");
      var mainFrameFour = document.getElementById("mainFrameFour");

      mainFrameOne.style.display = (
          mainFrameOne.style.display == "none" ? "none" : "none");
      mainFrameTwo.style.display = (
          mainFrameTwo.style.display == "none" ? "none" : "none");
      mainFrameThree.style.display = (
          mainFrameThree.style.display == "block" ? "block" : "block");
      mainFrameFour.style.display = (
          mainFrameFour.style.display == "none" ? "none" : "none");
    }

    function fourFunction() {
      var mainFrameOne = document.getElementById("mainFrameOne");
      var mainFrameTwo = document.getElementById("mainFrameTwo");
      var mainFrameThree = document.getElementById("mainFrameThree");
      var mainFrameFour = document.getElementById("mainFrameFour");

      mainFrameOne.style.display = (
          mainFrameOne.style.display == "none" ? "none" : "none");
      mainFrameTwo.style.display = (
          mainFrameTwo.style.display == "none" ? "none" : "none");
      mainFrameThree.style.display = (
          mainFrameThree.style.display == "none" ? "none" : "none");
      mainFrameFour.style.display = (
          mainFrameFour.style.display == "block" ? "block" : "block");
    }

  </script>

</head>
<body>
<!-- Navigation -->
<div name="navbar" th:replace="/../fragments/navbar ::navbar"></div>

<div class="container">
  <div class="row">
    <!-- Categories -->
    <div name="categorie" th:replace="/../fragments/categories ::categories"></div>


    <div class="col-lg 9" style="margin-top: 70px">

      <!-- Warnmeldungen -->
      <div class="alert alert-warning absolue center" th:if="${param.declined}">
        Could not accept article, because its already rented in the requested time.
      </div>
      <div class="alert alert-success absolue center" th:if="${param.successfulreturned}">
        The case will be closed. The deposit will be returned.
      </div>
      <div class="alert alert-success absolue center" th:if="${param.openedconflict}">
        A conflict is now open for given case. You will be informed by our employees.
      </div>
      <div class="alert alert-danger absolue center" th:if="${param.conflictfailed}">
        Failed to open a conflict.
      </div>

      <!-- Frame for articles from User-->
      <div id="mainFrameOne"
           th:style="'margin-top: 20px;display:'+${(param.articles!=null || (param.borrowed==null && param.returned==null && param.requests==null))? 'block' : 'none'}">
        <table class="table">
          <tr>
            <div class="text-center">
              <button class="btn btn-light" onclick="oneFunction()">My articles</button>
              <span> / </span>
              <button class="btn btn-light" onclick="twoFunction()"> Borrowed</button>
              <span> / </span>
              <button class="btn btn-light" onclick="threeFunction()"> Returned</button>
              <span> / </span>
              <button class="btn btn-light" onclick="fourFunction()"> Requests</button>
            </div>
          </tr>
          <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Price</th>
            <th scope="col">Deposit</th>
            <th scope="col">Status</th>
            <th scope="col"></th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="article: ${myArticles}">
            <td th:text="${article.name} "></td>
            <td th:text="${article.costPerDay} + '€'"></td>
            <td th:text="${article.deposit} + '€'"></td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Frame for borrowed articles from other users -->
      <div id="mainFrameTwo"
           th:style="'margin-top: 20px;display:'+${(param.borrowed!=null)? 'block' : 'none'}">
        <table class="table">
          <tr>
            <div class="text-center">
              <button class="btn btn-light" onclick="oneFunction()">My articles</button>
              <span> / </span>
              <button class="btn btn-light" onclick="twoFunction()">Borrowed</button>
              <span> / </span>
              <button class="btn btn-light" onclick="threeFunction()">Returned</button>
              <span> / </span>
              <button class="btn btn-light" onclick="fourFunction()">Requests</button>
            </div>
          </tr>
          <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Article</th>
            <th scope="col">From</th>
            <th scope="col">To</th>
            <th scope="col">Costs</th>
            <th scope="col">Status</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="case: ${borrowed}">
            <td><a th:href="@{~/profile/{username}(username=${case.article.owner.username})}"
                   th:text="${case.article.owner.username}"></a>
            </td>
            <td><a th:href="@{/article(id=${case.article.getId()})}"
                   th:text="${case.article.name}"></a>
            </td>
            <td th:text="${case.getFormattedStartTime()}"></td>
            <td th:text="${case.getFormattedEndTime()}"></td>
            <td th:text="${((case.endTime-case.startTime)/(1000*3600*24)*case.price)+'€'}"></td>
            <td>
              <th:block th:if="${case.requestStatus==1}">
                <button style="height:30px;width:80px" class="btn btn-outline-primary btn-sm">Pending</button>
              </th:block>
              <th:block th:if="${case.requestStatus==2}">
                <button style="height:30px;width:80px" class="btn btn-outline-success btn-sm">Accepted</button>
              </th:block>
              <th:block th:if="${case.requestStatus==12 || case.requestStatus==4}">
                <button style="height:30px;width:80px" class="btn btn-outline-danger btn-sm">Declined</button>
              </th:block>
              <th:block th:if="${case.requestStatus==10}">
                <button style="height:30px;width:80px" class="btn btn-outline-warning btn-sm">Open Conflict</button>
              </th:block>
              <th:block th:if="${case.requestStatus==7}">
                <button style="height:30px;width:80px" class="btn btn-outline-success btn-sm">Running</button>
              </th:block>
              <th:block th:if="${case.requestStatus==14}">
                <button style="height:30px;width:80px" class="btn btn-outline-info btn-sm">Finished</button>
              </th:block>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Frame for returned articles from other users -->
      <div id="mainFrameThree"
           th:style="'margin-top: 20px;display:'+${(param.returned!=null)? 'block' : 'none'}">
        <table class="table">
          <tr>
            <div class="text-center">
              <button class="btn btn-light" onclick="oneFunction()">My articles</button>
              <span> / </span>
              <button class="btn btn-light" onclick="twoFunction()"> Borrowed</button>
              <span> / </span>
              <button class="btn btn-light" onclick="threeFunction()"> Returned</button>
              <span> / </span>
              <button class="btn btn-light" onclick="fourFunction()"> Requests</button>
            </div>
          </tr>
          <thead>
          <tr>
            <th scope="col">Borrower</th>
            <th scope="col">Article</th>
            <th scope="col">Return Date</th>
            <th scope="col">Incoming</th>
            <th scope="col">Deposit</th>
            <th scope="col">Accept</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="case:${returned}">
            <td><a th:href="@{~/profile/{username}(username=${case.receiver.username})}"
                   th:text="${case.receiver.username}"></a>
            </td>
            <td><a th:href="@{/article(id=${case.article.getId()})}"
                   th:text="${case.article.name}"></a>
            </td>
            <td th:text="${case.getFormattedEndTime()}"></td>
            <td th:text="${((case.endTime-case.startTime)/(1000*3600*24)*case.price)+'€'}"></td>
            <td th:text="${case.deposit+'€'}"></td>
            <td style="white-space: nowrap">
              <div class="ml-auto flex-md-row" >
                <form style="display:inline-block" method="post" th:action="@{/accessed/user/acceptCaseReturn(id=${case.id})}">
                  <button class="btn btn-success btn-sm" type="submit">accept</button>
                </form>
                <span> </span>

                <!-- Button trigger modal -->
                <button class="btn btn-primary btn-sm" data-target="#exampleModal" data-toggle="modal"
                        type="button">conflict</button>

                <!-- Modal -->
                <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade"
                     id="exampleModal" role="dialog" tabindex="-1">
                  <div class="modal-dialog" role="document">
                    <form method="post" th:action="@{/accessed/user/openconflict(id=${case.id})}">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Open Conflict</h5>
                          <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <span>Article: </span> <span th:text="${case.article.name}"></span><br>
                          <span>Borrower: </span> <span th:text="${case.receiver.username}"></span>
                          <textarea class="form-control" style="height:300px;margin-top:20px" placeholder="What went wrong?"
                          name="conflictDescription"></textarea>
                        </div>
                        <div class="modal-footer">
                          <button class="btn btn-secondary" data-dismiss="modal" type="button">Close
                          </button>
                          <button class="btn btn-primary" type="submit">Send</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>

              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Frame for accepting people to borrow your article -->
      <div id="mainFrameFour"
         th:style="'margin-top: 20px;display:'+${(param.requests!=null)? 'block' : 'none'}">
      <table class="table">
        <tr>
          <div class="text-center">
            <button class="btn btn-light" onclick="oneFunction()">My articles</button>
            <span> / </span>
            <button class="btn btn-light" onclick="twoFunction()"> Borrowed</button>
            <span> / </span>
            <button class="btn btn-light" onclick="threeFunction()"> Returned</button>
            <span> / </span>
            <button class="btn btn-light" onclick="fourFunction()"> Requests</button>
          </div>
        </tr>
        <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Article</th>
          <th scope="col">From</th>
          <th scope="col">To</th>
          <th scope="col">Profit</th>
          <th scope="col">Status</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="case:${requested}">
          <td><a th:href="@{~/profile/{username}(username=${case.receiver.username})}"
                 th:text="${case.receiver.username}"></a>
          </td>
          <td><a th:href="@{/article(id=${case.article.getId()})}"
                 th:text="${case.article.name}"></a>
          </td>
          <td th:text="${case.getFormattedStartTime()}"></td>
          <td th:text="${case.getFormattedEndTime()}"></td>
          <td th:text="${((case.endTime-case.startTime)/(1000*3600*24)*case.price)+'€'}"></td>
          <td>
            <th:block th:if="${case.requestStatus==1}">
              <div class="row">
                <form method="post" th:action="@{~/accessed/user/acceptCase(id=${case.id})}">
                  <button style="height:30px;width:80px" class="btn btn-success btn-sm" type="submit">accept</button>
                </form>
                <span>  </span>
                <form method="post" th:action="@{~/accessed/user/declineCase(id=${case.id})}">
                  <button style="height:30px;width:80px" class="btn btn-danger btn-sm" type="submit">decline</button>
                </form>
              </div>
            </th:block>
            <th:block th:if="${case.requestStatus==2}">
              <div class="row">
                <button class="btn btn-outline-success btn-sm" style="height:30px;width:80px">Accepted</button>
              </div>
            </th:block>
            <th:block th:if="${case.requestStatus==12}">
              <div class="row">
                <button class="btn btn-outline-danger btn-sm" style="height:30px;width:80px">Declined</button>
              </div>
            </th:block>
            <th:block th:if="${case.requestStatus==4}">
              <div class="row">
                <button class="btn btn-outline-info btn-sm" style="height:30px;width:120px">Already rented</button>
              </div>
            </th:block>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    </div>
  </div>
</div>
<!-- Footer -->
<div name="footer" th:replace="/../fragments/footer ::footer"></div>
<script crossorigin="anonymous"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

<script src="https://rawgit.com/moment/moment/2.2.1/min/moment.min.js"></script>


<script crossorigin="anonymous"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

<script crossorigin="anonymous"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>


<script
    crossorigin="anonymous"
    integrity="sha256-5YmaxAwMjIpMrVlK84Y/+NjCpKnFYa8bWWBbUHSBGfU="
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
<!--
<script th:href="@{~/vendor/jquery/jquery.min.js}"></script>
<script th:href="@{~/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script> -->
</body>
</html>
